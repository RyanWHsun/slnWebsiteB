@model IEnumerable<prjWebsiteB.ViewModels.ProductViewModel>

@{
    ViewData["Title"] = "Index";
}
@section Styles
{
    <style>
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 50px;
            
        }

        .topic {
            margin: 20px;
            text-align:center;
        }

        .tableView{
            border-radius:15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color:white;
            padding-right: 50px;
        }

        .searchBar {
            display: flex;
            justify-content: flex-end;
            gap:10px;
        }

        .searchBar .form-control {
            width: 200px;
        }

        .content {
            margin: 20px;
        }

        .hidden-column {
            display: none;
        }
    </style>
}

<div class="container">
    <div class="topic">
        <h1>商品管理</h1>
    </div>

    <button class="btn btn-info">
        <a asp-action="Create">Create New</a>
    </button>
    <form method="get" id="filterForm">
        <div class="searchBar">
            <div class="mb-3 ">            
                <select id="categoryFilter" class="form-select" name="categoryId">
                    <option value="">所有類別</option>
                    @foreach (var category in ViewBag.ProductCategories)
                    {
                    <option value="@category.FProductCategoryId">@category.FCategoryName</option>
                    }
                </select>
            </div>
            <div class="mb-3 searchBar">
                <input type="text" name="searchString" class="form-control" placeholder="搜尋商品名稱" />
                <button type="button" class="btn btn-primary" onclick="submitFilterForm()">搜尋</button>
                <button type="button" class="btn btn-secondary" onclick="resetFilterForm()">重置</button>
            </div>
        </div>
    </form>
    <div class="tableView">
        <table class="table content table-bordered table-hover">
            <thead class="table-warning">
                <tr>
                    <th class="col-1"></th>
                    <th class="hidden-column">@Html.DisplayNameFor(model => model.FProductId)</th>
                    <th>@Html.DisplayNameFor(model => model.FImage)</th>
                    <th>@Html.DisplayNameFor(model => model.FProductName)</th>
                    <th class="hidden-column">@Html.DisplayNameFor(model => model.FProductDescription)</th>
                    <th>@Html.DisplayNameFor(model => model.FProductPrice)</th>
                    <th>@Html.DisplayNameFor(model => model.FIsOnSale)</th>
                    <th>@Html.DisplayNameFor(model => model.FProductDateAdd)</th>
                    <th>@Html.DisplayNameFor(model => model.FProductUpdated)</th>
                    <th>@Html.DisplayNameFor(model => model.FStock)</th>
                    <th>@Html.DisplayNameFor(model => model.FCategoryName)</th>
                    </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <div class="mb-2">
                                <a class="btn btn-success" asp-action="Details" asp-route-id="@item.FProductId">明細</a>
                            </div>
                            <div class="mb-2">
                                <a class="btn btn-primary" asp-action="Edit" asp-route-id="@item.FProductId">修改</a>
                            </div>
                            <div class="mb-2">
                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                        onclick="setDeleteId(@item.FProductId)">
                                    刪除
                                </button>
                            </div>
                        </td>
                        <td class="hidden-column">@Html.DisplayFor(modelItem => item.FProductId)</td>
                        <td>
                            <img src="@Url.Action("GetPicture","TProducts", new{id=@item.FProductId})" style="width:100px" />
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.FProductName)</td>
                        <td class="hidden-column">@Html.DisplayFor(modelItem => item.FProductDescription)</td>
                        <td>@Html.DisplayFor(modelItem => item.FProductPrice)</td>
                        <td>
                            @(item.FIsOnSale.GetValueOrDefault() ? "上架" : "下架")
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.FProductDateAdd)</td>
                        <td>@Html.DisplayFor(modelItem => item.FProductUpdated)</td>
                        <td>@Html.DisplayFor(modelItem => item.FStock)</td>
                        <td>@Html.DisplayFor(modelItem => item.FCategoryName)</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- 刪除確認模態框 -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">確認刪除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    您確定要刪除此商品嗎？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">確認刪除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 隱藏的表單 -->
    <form id="deleteForm" method="post" asp-action="DeleteConfirmed" asp-controller="TProducts">
        <input type="hidden" name="id" id="deleteId" />
    </form>
</div>

@section Scripts {
    <script>
        let deleteId = null;

        // 設定刪除的商品 ID
        function setDeleteId(id) {
        deleteId = id;
        document.getElementById("deleteId").value = id; // 將 ID 設置到隱藏表單中
        }

        // 確認刪除時觸發
        function confirmDelete() {
        document.getElementById("deleteForm").submit(); // 提交隱藏的表單
        }

        // 提交篩選表單
        function submitFilterForm() {
            document.getElementById("filterForm").submit();
        }

        // 重置篩選表單
        function resetFilterForm() {
            document.getElementById("categoryFilter").value = "";
            document.querySelector("input[name='searchString']").value = "";
            document.getElementById("filterForm").submit();
        }

    </script>
}
